% Options pour les packages chargés ailleurs
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\documentclass[$if(fontsize)$$fontsize$,$endif$$if(papersize)$$papersize$,$endif$12pt,a4paper]{article}

% Packages de base
\usepackage{xcolor}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp}
\else
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\usepackage{longtable,booktabs,array}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{bookmark}
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{geometry}
\usepackage[table]{xcolor}
\usepackage[french]{babel}
\usepackage{eso-pic}
\usepackage{tikz}
\usepackage{ocgx2} % Pour les couches interactives

% Définition de \pandocbounded pour redimensionner les images
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
\makeatother

% Définition des couleurs
\definecolor{maritimeBlue}{RGB}{0, 80, 120}
\definecolor{maritimeLightBlue}{RGB}{173, 216, 230}
\definecolor{maritimeDarkBlue}{RGB}{0, 50, 80}
\definecolor{lightblue}{RGB}{200, 230, 255}

% Configuration des marges
\geometry{
  left=2.5cm,
  right=2.5cm,
  top=2.5cm,
  bottom=2.5cm,
  headheight=15pt,
  footskip=40pt
}

% Suppression de l'indentation
\setlength{\parindent}{0pt}
\setlength{\parskip}{1em}

% Définition de \tightlist pour les listes serrées
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Définition des couches OCGs pour le quadrillage et le trait
\begin{ocg}[printocg=always]{Quadrillage et marge}{quadrillage}{1}
\end{ocg}

% Commande pour afficher/masquer le quadrillage
\DeclareRobustCommand{\togglequadrillage}{%
  \begin{ocg}{Quadrillage et marge}{quadrillage}{0}%
    \begin{tikzpicture}[remember picture, overlay]
      \draw[step=5mm, lightblue, very thin] (current page.south west) grid (current page.north east);
    \end{tikzpicture}
    \begin{tikzpicture}[remember picture, overlay]
      \draw[red, thick] ([xshift=2cm]current page.north west) -- ([xshift=2cm]current page.south west);
    \end{tikzpicture}
  \end{ocg}%
}



% Ajoutez le quadrillage et le trait à chaque page
\AddToShipoutPictureBG{%
  \togglequadrillage%
}

% En-têtes et pieds de page
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.2pt}
\renewcommand{\footrulewidth}{0.2pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{maritimeBlue}\leaders\hrule height \headrulewidth\hfill}}
\renewcommand{\footrule}{\hbox to\headwidth{\color{maritimeBlue}\leaders\hrule height \footrulewidth\hfill}}
\fancyhead[L]{\textcolor{maritimeDarkBlue}{\nouppercase{\leftmark}}}
\fancyhead[R]{\colorbox{maritimeDarkBlue}{\textcolor{white}{$classe$}}}
\fancyfoot[L]{\footnotesize\textcolor{maritimeDarkBlue}{Document mis à jour le \today}}
\fancyfoot[C]{\colorbox{maritimeDarkBlue}{\textcolor{white}{\thepage}}}
\fancyfoot[R]{\footnotesize\textcolor{maritimeDarkBlue}{LPM BL-ZEG}}

% Configuration des couleurs des lignes du tableau
\rowcolors{2}{maritimeLightBlue!30}{white}

% Désactive les figures flottantes
\usepackage{float}
\floatplacement{figure}{H}

% Configuration des liens hypertexte
\hypersetup{
  pdftitle=$if(title)$$title$$endif$,
  pdfauthor=$if(author)$$author$$endif$,
  pdflang=$if(lang)$$lang$$endif$,
  colorlinks=true,
  linkcolor=maritimeDarkBlue,
  citecolor=maritimeDarkBlue,
  urlcolor=maritimeDarkBlue,
  hidelinks=false,
  pdfcreator={$if(creator)$$creator$$else$LaTeX via pandoc$endif$}
}

% Style des titres
\usepackage{titlesec}
\titleformat{\section}
  {\normalfont\Large\bfseries\color{maritimeDarkBlue}}
  {\thesection}{1em}{}
\titleformat{\subsection}
  {\normalfont\large\bfseries\color{maritimeDarkBlue}}
  {\thesubsection}{1em}{}

% Début du document
\begin{document}


% Titre
$if(title)$
\title{\color{maritimeDarkBlue}$title$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$else$
\date{\today}
$endif$

\maketitle

% Table des matières
$if(toc)$
\tableofcontents
\clearpage
$endif$

% Contenu du document
$body$

\end{document}
